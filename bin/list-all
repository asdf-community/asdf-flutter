#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

currentDir="$(dirname $0)"

source "${currentDir}/jq-downloader"
source "${currentDir}/utils.sh"

list_all() {
  local versionListUrl="${FLUTTER_STORAGE_BASE_URL}/flutter_infra_release/releases/releases_${OS}.json"

  echo $(curl -sL "${versionListUrl}" | "${JQ_BIN}" -r '.releases[].version |= gsub("^v"; "") | .releases | map(.version + "-" + .channel) | reverse | join(" ")')
}

download_jq_if_not_exists
list_all
